define(["jquery","core/ajax","core/notification"],function(a,b,c){return{init:function(d,e,f,g,h){a(function(){function i(b,c){var d=parseInt(b.getElementsByClassName("easy_nb")[0].innerText),e=parseInt(b.getElementsByClassName("better_nb")[0].innerText),f=parseInt(b.getElementsByClassName("hard_nb")[0].innerText),h="group_";if(d&&(h+="E"),e&&(h+="B"),f&&(h+="H"),x[c]!==v.NULL){var i=a("#module-"+c+" .group_nb");i.addClass("voted"),y[c]>=10&&i.css({"font-size":"10px"})}else a("#module-"+c+" .group_nb").removeClass("voted");a("#module-"+c+" .group_img").attr("src",g[h])}function j(a){var b,c=!1;return r.forEach(function(d){parseInt(d.cmid)===a&&(b=d,c=!0)}),c||(b={cmid:a.toString(),courseid:t,total:"0",typeone:"0",typetwo:"0",typethree:"0",uservote:"0"}),b}function k(b){a(this).stop(),a(this).css({cursor:"pointer"}),a(this).animate({top:-1.5,left:-3,height:23},100),A[b.data.moduleId]=setTimeout(function(){0===parseInt(b.data.module.getElementsByClassName("easy_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .easy").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),0===parseInt(b.data.module.getElementsByClassName("better_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .better").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),0===parseInt(b.data.module.getElementsByClassName("hard_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .hard").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),a("#module-"+b.data.moduleId+" .group_img").animate({top:"+=15",left:"+=35",height:0},300).hide(0),a("#module-"+b.data.moduleId+" .group_nb").delay(50).hide(300),a("#module-"+b.data.moduleId+" .actions").hide(300),a("#module-"+b.data.moduleId+" .easy").delay(50).animate({top:-15,left:-20,height:20},300).css({"pointer-events":"auto"}),a("#module-"+b.data.moduleId+" .easy_nb").delay(50).show(300),a("#module-"+b.data.moduleId+" .better").delay(200).animate({top:-15,left:25,height:20},300).css({"pointer-events":"auto"}),a("#module-"+b.data.moduleId+" .better_nb").delay(200).show(300),a("#module-"+b.data.moduleId+" .hard").delay(400).animate({top:-15,left:70,height:20},300).css({"pointer-events":"auto"}),a("#module-"+b.data.moduleId+" .hard_nb").delay(400).show(300)},500),clearTimeout(z[b.data.moduleId]),z[b.data.moduleId]=setTimeout(function(){w[b.data.moduleId]||(a("#module-"+b.data.moduleId+" .hard").css({"pointer-events":"none"}).delay(50).animate({top:-7.5,left:80,height:0},500),a("#module-"+b.data.moduleId+" .hard_nb").delay(50).hide(300),a("#module-"+b.data.moduleId+" .better").css({"pointer-events":"none"}).delay(300).animate({top:-7.5,left:35,height:0},500),a("#module-"+b.data.moduleId+" .better_nb").delay(300).hide(300),a("#module-"+b.data.moduleId+" .easy").css({"pointer-events":"none"}).delay(600).animate({top:-7.5,left:-10,height:0},500),a("#module-"+b.data.moduleId+" .easy_nb").delay(600).hide(300),i(b.data.module,b.data.moduleId),a("#module-"+b.data.moduleId+" .group_img").show(0).delay(500).animate({top:0,left:0,height:20},300),0!==parseInt(b.data.module.getElementsByClassName("group_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .group_nb").delay(600).show(300),a("#module-"+b.data.moduleId+" .actions").delay(600).show(300))},2e3)}function l(b){a(this).stop(),clearTimeout(A[b.data.moduleId]),"0px"===a("#module-"+b.data.moduleId+" .easy").css("height")&&a(this).animate({top:0,left:0,height:20},100)}function m(b){a(this).stop();var c=a("#module-"+b.data.moduleId+" ."+b.data.reactionName+"_txt").width();a("#module-"+b.data.moduleId+" ."+b.data.reactionName+"_txt").css({left:b.data.leftReaction+10-c/2+60});var d=parseInt(b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText);0===d&&a("#module-"+b.data.moduleId+" ."+b.data.reactionName).css({"-webkit-filter":"",filter:""}),a(this).css({cursor:"pointer"}),a(this).animate({top:-25,left:b.data.leftReaction,height:40},100)}function n(b){a(this).stop(),a(this).animate({top:-15,left:b.data.leftReaction,height:20},100);var c=parseInt(b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText);0===c&&a("#module-"+b.data.moduleId+" ."+b.data.reactionName).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"})}function o(d){if(null!==s&&1!==s){var e=parseInt(d.data.module.getElementsByClassName(d.data.reactionName+"_nb")[0].innerText);y[d.data.moduleId]=parseInt(d.data.module.getElementsByClassName("group_nb")[0].innerText),0===e&&a("#module-"+d.data.moduleId+" ."+d.data.reactionName).css({"-webkit-filter":"",filter:""}),x[d.data.moduleId]===v.NULL?b.call([{methodname:"block_point_view_update_db",args:{func:"insert",userid:s,courseid:t,cmid:d.data.moduleId,vote:d.data.reactionSelect},done:function(){d.data.module.getElementsByClassName(d.data.reactionName+"_nb")[0].innerText=e+1,a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").css({"font-weight":"bold",color:"#5585B6"}),d.data.module.getElementsByClassName("group_nb")[0].innerText=y[d.data.moduleId]+1,x[d.data.moduleId]=d.data.reactionSelect},fail:c.exception}]):x[d.data.moduleId]===d.data.reactionSelect?b.call([{methodname:"block_point_view_update_db",args:{func:"remove",userid:s,courseid:t,cmid:d.data.moduleId,vote:d.data.reactionSelect},done:function(){e--,d.data.module.getElementsByClassName(d.data.reactionName+"_nb")[0].innerText=e,a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").css({"font-weight":"normal",color:"black"}),0===e&&a("#module-"+d.data.moduleId+" ."+d.data.reactionName).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),d.data.module.getElementsByClassName("group_nb")[0].innerText=y[d.data.moduleId]-1,x[d.data.moduleId]=v.NULL},fail:c.exception}]):b.call([{methodname:"block_point_view_update_db",args:{func:"update",userid:s,courseid:t,cmid:d.data.moduleId,vote:d.data.reactionSelect},done:function(){d.data.module.getElementsByClassName(d.data.reactionName+"_nb")[0].innerText=e+1,a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").css({"font-weight":"bold",color:"#5585B6"});var b;switch(x[d.data.moduleId]){case v.EASY:b="easy";break;case v.BETTER:b="better";break;case v.HARD:b="hard"}var c=parseInt(d.data.module.getElementsByClassName(b+"_nb")[0].innerText)-1;d.data.module.getElementsByClassName(b+"_nb")[0].innerText=c,a("#module-"+d.data.moduleId+" ."+b+"_nb").css({"font-weight":"normal",color:"black"}),0===c&&a("#module-"+d.data.moduleId+" ."+b).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),x[d.data.moduleId]=d.data.reactionSelect},fail:c.exception}])}}function p(a){w[a.data.moduleId]=!0}function q(b){w[b.data.moduleId]=!1,clearTimeout(z[b.data.moduleId]),z[b.data.moduleId]=setTimeout(function(){w[b.data.moduleId]||(a("#module-"+b.data.moduleId+" .hard").css({"pointer-events":"none"}).delay(50).animate({top:-7.5,left:80,height:0},500),a("#module-"+b.data.moduleId+" .hard_nb").delay(50).hide(300),a("#module-"+b.data.moduleId+" .better").css({"pointer-events":"none"}).delay(300).animate({top:-7.5,left:35,height:0},500),a("#module-"+b.data.moduleId+" .better_nb").delay(300).hide(300),a("#module-"+b.data.moduleId+" .easy").css({"pointer-events":"none"}).delay(600).animate({top:-7.5,left:-10,height:0},500),a("#module-"+b.data.moduleId+" .easy_nb").delay(600).hide(300),i(b.data.module,b.data.moduleId),a("#module-"+b.data.moduleId+" .group_img").show(0).delay(500).animate({top:0,left:0,height:20},300),0!==parseInt(b.data.module.getElementsByClassName("group_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .group_nb").delay(600).show(300),a("#module-"+b.data.moduleId+" .actions").delay(600).show(300))},1e3)}a(".mod-indent-outer").css({width:"85%"});var r=d,s=parseInt(h.userid),t=h.courseid,u=e,v={NULL:0,EASY:1,BETTER:2,HARD:3},w={},x={},y={},z={},A={};u.forEach(function(a){var b=parseInt(a);w[b]=!1,x[b]=null,y[b]=null,z[b]=null,A[b]=null}),u.forEach(function(b){var c=parseInt(b);if(null!==document.getElementById("module-"+c)){a("#module-"+b).mouseover(function(){a(this).css({background:"linear-gradient(to right, #f4f4f4, #f4f4f4, white)","border-radius":"5px"})}).mouseout(function(){a(this).css({background:""})});var d=j(c),e='<div class="reactions"><!-- EASY ! --><span class="tooltipreaction"><img src="'+g.easy+'" alt=" " class="easy"/><span class="tooltiptextreaction easy_txt">'+g.easytxt+'</span></span><span class="easy_nb">'+d.typeone+'</span><!-- I\'M GETTING BETTER --><span class="tooltipreaction"><img src="'+g.better+'" alt=" " class="better"/><span class="tooltiptextreaction better_txt">'+g.bettertxt+'</span></span><span class="better_nb">'+d.typetwo+'</span><!-- SO HARD... --><span class="tooltipreaction"><img src="'+g.hard+'" alt=" " class="hard"/><span class="tooltiptextreaction hard_txt">'+g.hardtxt+'</span></span><span class="hard_nb">'+d.typethree+'</span></div><!-- GROUP --><div class="group"><img src="" alt=" " class="group_img"/><span class="group_nb">'+d.total+"</span></div>";switch(a("#module-"+c+" .activityinstance").append(e),parseInt(d.uservote)){case 1:x[c]=v.EASY,a("#module-"+c+" .easy_nb").css({"font-weight":"bold",color:"#5585B6"});break;case 2:x[c]=v.BETTER,a("#module-"+c+" .better_nb").css({"font-weight":"bold",color:"#5585B6"});break;case 3:x[c]=v.HARD,a("#module-"+c+" .hard_nb").css({"font-weight":"bold",color:"#5585B6"});break;default:x[c]=v.NULL}var f=document.getElementById("module-"+c);0===parseInt(f.getElementsByClassName("group_nb")[0].innerText)&&a("#module-"+c+" .group_nb").hide(),i(f,c),a("#module-"+c+" .group_img").mouseover({module:f,moduleId:c},k).click({module:f,moduleId:c},k).mouseout({moduleId:c},l),a("#module-"+c+" .easy").mouseover({module:f,moduleId:c,reactionName:"easy",className:"easy_txt",leftReaction:-30},m).mouseout({module:f,moduleId:c,leftReaction:-20,reactionName:"easy"},n).click({module:f,moduleId:c,reactionName:"easy",reactionSelect:v.EASY},o),a("#module-"+c+" .better").mouseover({module:f,moduleId:c,reactionName:"better",className:"better_txt",leftReaction:15},m).mouseout({module:f,moduleId:c,leftReaction:25,reactionName:"better"},n).click({module:f,moduleId:c,reactionName:"better",reactionSelect:v.BETTER},o);var h=a("#module-"+c+" .hard"),r=parseInt(h.css("left").slice(0,-2),10);h.mouseover({module:f,moduleId:c,reactionName:"hard",className:"hard_txt",leftReaction:r-20},m).mouseout({module:f,moduleId:c,leftReaction:r-10,reactionName:"hard"},n).click({module:f,moduleId:c,reactionName:"hard",reactionSelect:v.HARD},o),a("#module-"+c+" .reactions").mouseover({moduleId:c},p).mouseout({module:f,moduleId:c},q)}}),a.each(f,function(b,c){if("0"!==c){var d;switch(parseInt(c)){case 1:d="green";break;case 2:d="blue";break;case 3:d="red";break;case 4:d="black"}var e='<div class="track '+d+'track"></div>';a("#module-"+b+" .activityinstance a").prepend(e)}else{var f='<span class="track"></span>';a("#module-"+b+" .activityinstance a").prepend(f)}}),a(".greentrack").css({"background-color":h.greentrack}),a(".bluetrack").css({"background-color":h.bluetrack}),a(".redtrack").css({"background-color":h.redtrack}),a(".blacktrack").css({"background-color":h.blacktrack}),a("#menu_point_view_img").mouseover(function(){a(this).css({"-webkit-filter":"invert(100%)","-moz-filter":"invert(100%)","-o-filter":"invert(100%)","-ms-filter":"invert(100%)"})}).mouseout(function(){a(this).css({"-webkit-filter":"invert(0%)","-moz-filter":"invert(0%)","-o-filter":"invert(0%)","-ms-filter":"invert(0%)"})})})}}});