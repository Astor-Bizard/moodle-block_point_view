define(["jquery"],function(a){return{init:function(b,c,d,e,f){a(function(){function g(b,c){var d=parseInt(b.getElementsByClassName("easy_nb")[0].innerText),f=parseInt(b.getElementsByClassName("better_nb")[0].innerText),g=parseInt(b.getElementsByClassName("hard_nb")[0].innerText),h="group_";if(d&&(h+="E"),f&&(h+="B"),g&&(h+="H"),v[c]!==t.NULL){var i=a("#module-"+c+" .group_nb");i.addClass("voted"),w[c]>=10&&i.css({"font-size":"10px"})}else a("#module-"+c+" .group_nb").removeClass("voted");a("#module-"+c+" .group_img").attr("src",e[h])}function h(a){var b,c=!1;return p.forEach(function(d){parseInt(d.cmid)===a&&(b=d,c=!0)}),c||(b={cmid:a.toString(),courseid:r,total:"0",typeone:"0",typetwo:"0",typethree:"0",uservote:"0"}),b}function i(b){a(this).css({cursor:"pointer"}),a(this).animate({top:-1.5,left:-3,height:23},100),a(this).clearQueue(),y[b.data.moduleId]=setTimeout(function(){0===parseInt(b.data.module.getElementsByClassName("easy_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .easy").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),0===parseInt(b.data.module.getElementsByClassName("better_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .better").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),0===parseInt(b.data.module.getElementsByClassName("hard_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .hard").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),a("#module-"+b.data.moduleId+" .group_img").animate({top:13,left:20,height:0},300).hide(0),a("#module-"+b.data.moduleId+" .group_nb").delay(50).hide(300),a("#module-"+b.data.moduleId+" .easy").delay(50).animate({top:-15,left:-20,height:20},300).css({"pointer-events":"auto"}),a("#module-"+b.data.moduleId+" .easy_nb").delay(50).show(300),a("#module-"+b.data.moduleId+" .better").delay(200).animate({top:-15,left:25,height:20},300).css({"pointer-events":"auto"}),a("#module-"+b.data.moduleId+" .better_nb").delay(200).show(300),a("#module-"+b.data.moduleId+" .hard").delay(400).animate({top:-15,left:70,height:20},300).css({"pointer-events":"auto"}),a("#module-"+b.data.moduleId+" .hard_nb").delay(400).show(300)},500),clearTimeout(x[b.data.moduleId]),x[b.data.moduleId]=setTimeout(function(){u[b.data.moduleId]||(a("#module-"+b.data.moduleId+" .hard").css({"pointer-events":"none"}).delay(50).animate({top:-7.5,left:80,height:0},500),a("#module-"+b.data.moduleId+" .hard_nb").delay(50).hide(300),a("#module-"+b.data.moduleId+" .better").css({"pointer-events":"none"}).delay(300).animate({top:-7.5,left:35,height:0},500),a("#module-"+b.data.moduleId+" .better_nb").delay(300).hide(300),a("#module-"+b.data.moduleId+" .easy").css({"pointer-events":"none"}).delay(600).animate({top:-7.5,left:-10,height:0},500),a("#module-"+b.data.moduleId+" .easy_nb").delay(600).hide(300),g(b.data.module,b.data.moduleId),a("#module-"+b.data.moduleId+" .group_img").show(0).delay(500).animate({top:0,left:0,height:20},300),0!==parseInt(b.data.module.getElementsByClassName("group_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .group_nb").delay(600).show(300))},2e3)}function j(b){clearTimeout(y[b.data.moduleId]),"0px"===a("#module-"+b.data.moduleId+" .easy").css("height")&&(a(this).animate({top:0,left:0,height:20},100),a(this).clearQueue())}function k(b){a("#module-"+b.data.moduleId+" .tooltipreaction .tooltiptextreaction").css({left:b.data.leftTxt});var c=parseInt(b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText);0===c&&a("#module-"+b.data.moduleId+" ."+b.data.reactionName).css({"-webkit-filter":"",filter:""}),a(this).css({cursor:"pointer"}),a(this).animate({top:-25,left:b.data.leftReaction,height:40},100),a(this).clearQueue()}function l(b){a(this).animate({top:-15,left:b.data.leftReaction,height:20},100);var c=parseInt(b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText);0===c&&a("#module-"+b.data.moduleId+" ."+b.data.reactionName).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),a(this).clearQueue()}function m(b){console.log("CLICKED");var c=parseInt(b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText);w[b.data.moduleId]=parseInt(b.data.module.getElementsByClassName("group_nb")[0].innerText),0===c&&a("#module-"+b.data.moduleId+" ."+b.data.reactionName).css({"-webkit-filter":"",filter:""}),v[b.data.moduleId]===t.NULL?a.ajax({type:"POST",url:"../blocks/like/update_db.php",dataType:"json",data:{func:"insert",userid:q,courseid:r,cmid:b.data.moduleId,vote:b.data.reactionSelect},success:function(d){console.log(d),b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText=c+1,a("#module-"+b.data.moduleId+" ."+b.data.reactionName+"_nb").css({"font-weight":"bold",color:"#5585B6"}),b.data.module.getElementsByClassName("group_nb")[0].innerText=w[b.data.moduleId]+1,v[b.data.moduleId]=b.data.reactionSelect}}):v[b.data.moduleId]===b.data.reactionSelect?a.ajax({type:"POST",url:"../blocks/like/update_db.php",dataType:"json",data:{func:"remove",userid:q,courseid:r,cmid:b.data.moduleId,vote:b.data.reactionSelect},success:function(d){console.log(d),c--,b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText=c,a("#module-"+b.data.moduleId+" ."+b.data.reactionName+"_nb").css({"font-weight":"normal",color:"black"}),0===c&&a("#module-"+b.data.moduleId+" ."+b.data.reactionName).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),b.data.module.getElementsByClassName("group_nb")[0].innerText=w[b.data.moduleId]-1,v[b.data.moduleId]=t.NULL}}):a.ajax({type:"POST",url:"../blocks/like/update_db.php",dataType:"json",data:{func:"update",userid:q,courseid:r,cmid:b.data.moduleId,vote:b.data.reactionSelect},success:function(d){console.log(d),b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText=c+1,a("#module-"+b.data.moduleId+" ."+b.data.reactionName+"_nb").css({"font-weight":"bold",color:"#5585B6"});var e;switch(v[b.data.moduleId]){case t.EASY:e="easy";break;case t.BETTER:e="better";break;case t.HARD:e="hard"}var f=parseInt(b.data.module.getElementsByClassName(e+"_nb")[0].innerText)-1;b.data.module.getElementsByClassName(e+"_nb")[0].innerText=f,a("#module-"+b.data.moduleId+" ."+e+"_nb").css({"font-weight":"normal",color:"black"}),0===f&&a("#module-"+b.data.moduleId+" ."+e).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),v[b.data.moduleId]=b.data.reactionSelect}})}function n(a){u[a.data.moduleId]=!0}function o(b){u[b.data.moduleId]=!1,clearTimeout(x[b.data.moduleId]),x[b.data.moduleId]=setTimeout(function(){u[b.data.moduleId]||(a("#module-"+b.data.moduleId+" .hard").css({"pointer-events":"none"}).delay(50).animate({top:-7.5,left:80,height:0},500),a("#module-"+b.data.moduleId+" .hard_nb").delay(50).hide(300),a("#module-"+b.data.moduleId+" .better").css({"pointer-events":"none"}).delay(300).animate({top:-7.5,left:35,height:0},500),a("#module-"+b.data.moduleId+" .better_nb").delay(300).hide(300),a("#module-"+b.data.moduleId+" .easy").css({"pointer-events":"none"}).delay(600).animate({top:-7.5,left:-10,height:0},500),a("#module-"+b.data.moduleId+" .easy_nb").delay(600).hide(300),g(b.data.module,b.data.moduleId),a("#module-"+b.data.moduleId+" .group_img").show(0).delay(500).animate({top:0,left:0,height:20},300),0!==parseInt(b.data.module.getElementsByClassName("group_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .group_nb").delay(600).show(300))},1e3)}var p=b,q=f.userid,r=f.courseid,s=c,t={NULL:0,EASY:1,BETTER:2,HARD:3},u={},v={},w={},x={},y={};s.forEach(function(a){var b=parseInt(a);u[b]=!1,v[b]=null,w[b]=null,x[b]=null,y[b]=null}),s.forEach(function(b){var c=parseInt(b);if(null!==document.getElementById("module-"+c)){var d=h(c),f='<div class="reactions"><!-- EASY ! --><span class="tooltipreaction"><img src="'+e.easy+'" alt=" " class="easy"/><span class="tooltiptextreaction easy_txt">'+e.easytxt+'</span></span><span class="easy_nb">'+d.typeone+'</span><!-- I\'M GETTING BETTER --><span class="tooltipreaction"><img src="'+e.better+'" alt=" " class="better"/><span class="tooltiptextreaction better_txt">'+e.bettertxt+'</span></span><span class="better_nb">'+d.typetwo+'</span><!-- SO HARD... --><span class="tooltipreaction"><img src="'+e.hard+'" alt=" " class="hard"/><span class="tooltiptextreaction hard_txt">'+e.hardtxt+'</span></span><span class="hard_nb">'+d.typethree+'</span></div><!-- GROUP --><div class="group"><img src="" alt=" " class="group_img"/><span class="group_nb">'+d.total+"</span></div>";switch(a("#module-"+c+" .activityinstance").append(f),parseInt(d.uservote)){case 1:v[c]=t.EASY,a("#module-"+c+" .easy_nb").css({"font-weight":"bold",color:"#5585B6"});break;case 2:v[c]=t.BETTER,a("#module-"+c+" .better_nb").css({"font-weight":"bold",color:"#5585B6"});break;case 3:v[c]=t.HARD,a("#module-"+c+" .hard_nb").css({"font-weight":"bold",color:"#5585B6"});break;default:v[c]=t.NULL}var p=document.getElementById("module-"+c);0===parseInt(p.getElementsByClassName("group_nb")[0].innerText)&&a("#module-"+c+" .group_nb").hide(),g(p,c),a("#module-"+c+" .group_img").mouseover({module:p,moduleId:c},i).on("click",{module:p,moduleId:c},i).mouseout({moduleId:c},j),a("#module-"+c+" .easy").mouseover({module:p,moduleId:c,reactionName:"easy",className:"easy_txt",leftTxt:15,leftReaction:-30},k).mouseout({module:p,moduleId:c,leftReaction:-20,reactionName:"easy"},l).on("click",{module:p,moduleId:c,reactionName:"easy",reactionSelect:t.EASY},m),a("#module-"+c+" .better").mouseover({module:p,moduleId:c,reactionName:"better",className:"better_txt",leftTxt:40,leftReaction:15},k).mouseout({module:p,moduleId:c,leftReaction:25,reactionName:"better"},l).on("click",{module:p,moduleId:c,reactionName:"better",reactionSelect:t.BETTER},m),a("#module-"+c+" .hard").mouseover({module:p,moduleId:c,reactionName:"hard",className:"hard_txt",leftTxt:105,leftReaction:60},k).mouseout({module:p,moduleId:c,leftReaction:70,reactionName:"hard"},l).on("click",{module:p,moduleId:c,reactionName:"hard",reactionSelect:t.HARD},m),a("#module-"+c+" .reactions").mouseover({moduleId:c},n).mouseout({module:p,moduleId:c},o)}}),a.each(d,function(b,c){if(0!==c){var d;switch(parseInt(c)){case 1:d="green";break;case 2:d="blue";break;case 3:d="red";break;case 4:d="black"}var e='<span class="track '+d+'track"></span>';a("#module-"+b+" .activityinstance").prepend(e)}}),a("#menu_like_img").mouseover(function(){a(this).animate({top:"-=30",left:"-=3",width:45},100),a(this).clearQueue()}).mouseout(function(){a(this).animate({top:"+=2.5",left:"+=3",width:40},100),a(this).clearQueue()}),a(".greentrack").css({"background-color":f.greentrack}),a(".bluetrack").css({"background-color":f.bluetrack}),a(".redtrack").css({"background-color":f.redtrack}),a(".blacktrack").css({"background-color":f.blacktrack})})}}});